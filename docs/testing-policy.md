# テストガイド (Testing Guide)

## テストディレクトリの構造

### 単体テスト (Unit Tests) (`src/**/*.test.ts`)

**ルール:** 単体テストは、テスト対象のソースコードと **同じ場所** に配置（コロケーション）してください。

- 例: `src/features/shanten/logic/mentsute.ts` のテストは `src/features/shanten/logic/mentsute.test.ts`

**理由:**
- **発見容易性と保守性:** 実装コードとテストコードを物理的に近くに配置することで、対応するテストを即座に見つけ出し、コード修正時のフィードバックループを高速化するため。

### 受け入れテスト (Acceptance Tests) (`tests/acceptance/*.test.ts`)

**ルール:** 受け入れテストは、`src` とは分離された `tests/acceptance` ディレクトリ以下に配置してください。

**理由:**
- **関心事の分離:** 性質の異なる「単体テスト」と「受け入れテスト」を明確に区別するため。受け入れテストは内部構造（ホワイトボックス）ではなく、外部仕様（ブラックボックス）を検証するものであり、配置場所も実装から切り離すべきです。

### 公開APIテスト (Public API Tests) (`tests/public-api.test.ts`)

**ルール:** ライブラリとして公開するAPIのエクスポート有無や型シグネチャを検証するテストは `tests/public-api.test.ts` に集約してください。

**理由:**
- **契約の保証:** 誤って公開APIを変更・削除してしまう（破壊的変更）リスクを防ぐため。
- **後方互換性:** バージョンアップ時の互換性チェックを容易にするため。

## 型のテスト (Type Testing)

**目的:**
1. **複雑性の管理:** TypeScriptの型システムは条件分岐や再帰など高度なロジックを持つことができ、複雑化すると型定義自体がバグの温床となるため。
2. **実装との乖離防止:** 型定義（特に `.d.ts` や `as`）は実行時の実装と独立して定義可能であるため、開発に伴う「型定義と実態の乖離（同期ズレ）」を防ぎ、実体が型定義通りに振る舞うことを保証するため。

### ツールの使い分け基準

1.  **通常のプロジェクトコード (Recommended)**
    -   **ツール:** `vitest` (標準の `expectTypeOf`)
    -   **使用例:**
        ```typescript
        import { expectTypeOf } from 'vitest';
        expectTypeOf(value).toEqualTypeOf<ExpectedType>();
        ```
    -   **理由:** セットアップ不要で、構造的な型チェックが可能。リファクタリングへの追従性も高く、`1|2` と `2|1` のような意味のない順序の違いで失敗しないため扱いやすい。

2.  **型の「表示」をテストしたい場合**
    -   **ツール:** `eslint-plugin-expect-type`
    -   **使用例:** `// ^?` や `// $ExpectType string` コメント。
    -   **理由:** エディタ上での「型の見え方」を保証したい場合や、`number|string` と `string|number` のような表示上の違いを厳密に区別してテストしたい場合に利用。

3.  **DefinitelyTyped (型定義ライブラリ)**
    -   **ツール:** `dtslint`
    -   **理由:** 型定義ファイルのコミュニティ標準ツールであるため。

